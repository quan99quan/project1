let listProductsStock=[
    {
        img:"../images/productItems/nha/livingroom1.jpg",
        img1:"../images/productItems/nha/livingroom1.1.jpg",
        img2:"../images/productItems/nha/livingroom1.2.jpg",
        img3:"../images/productItems/nha/livingroom1.3.jpg",
        name: "TV shelf",
        price:500,
        quantity:1,
        star: "★★★★★",
        type:"Livingroom",
        description: "Good product, high quality, reasonable price, worth buying, Brief introduction of wood products and export situation in Vietnam today: Wood and wood products are one of the key economic export products of the country and a bright spot in the export picture. As a result, wood products also gradually become diversified, many designs are abundant" ,
        options:[
            {
                src:"../images/productItems/nha/livingroom2.jpg",
                size:[
                    {
                        key:"S",
                        stock: 10,
                    },
                    {
                        key:"M",
                        stock: 20,
                    },
                    {
                        key:"L",
                        stock: 30,
                    }
                ]
            }
        ]
    },
    
    {
        img:"../images/productItems/nha/livingroom2.jpg",
        img1:"../images/productItems/nha/livingroom2.1.jpg",
        img2:"../images/productItems/nha/livingroom2.2.jpg",
        img3:"../images/productItems/nha/livingroom2.3.jpg",
        name:"Sofa",
        price:600,
        quantity:1,
        star: "★★★★★",
        type:"Livingroom",
        description: "Good product, high quality, reasonable price, worth buying, Brief introduction of wood products and export situation in Vietnam today: Wood and wood products are one of the key economic export products of the country and a bright spot in the export picture. As a result, wood products also gradually become diversified, many designs are abundant" ,
        options:[
            {
                src:"../images/productItems/nha/livingroom2.jpg",
                size:[
                    {
                        key:"S",
                        stock: 10,
                    },
                    {
                        key:"M",
                        stock: 20,
                    },
                    {
                        key:"L",
                        stock: 30,
                    }
                ]
            }
        ]
    },
    {
        img:"../images/productItems/nha/livingroom3.jpg",
        img1:"../images/productItems/nha/livingroom3.1.jpg",
        img2:"../images/productItems/nha/livingroom3.2.jpg",
        img3:"../images/productItems/nha/livingroom3.3.jpg",
        name:"Table",
        price:400,
        quantity:1,
        star: "★★★★★",
        type:"Livingroom",
        description: "Good product, high quality, reasonable price, worth buying, Brief introduction of wood products and export situation in Vietnam today: Wood and wood products are one of the key economic export products of the country and a bright spot in the export picture. As a result, wood products also gradually become diversified, many designs are abundant" ,
        options:[
            {
                src:"../images/productItems/nha/livingroom3.jpg",
                size:[
                    {
                        key:"S",
                        stock: 10,
                    },
                    {
                        key:"M",
                        stock: 20,
                    },
                    {
                        key:"L",
                        stock: 30,
                    }
                ]
            }
        ]
    },
    {
        img:"../images/productItems/nha/livingroom4.jpg",
        img1:"../images/productItems/nha/livingroom4.1.jpg",
        img2:"../images/productItems/nha/livingroom4.2.jpg",
        img3:"../images/productItems/nha/livingroom4.3.jpg",
        name: "Shoe racks",
        price:300,
        quantity:1,
        star: "★★★★★",
        type:"Livingroom",
        description: "Good product, high quality, reasonable price, worth buying, Brief introduction of wood products and export situation in Vietnam today: Wood and wood products are one of the key economic export products of the country and a bright spot in the export picture. As a result, wood products also gradually become diversified, many designs are abundant" ,
        options:[
            {
                src:"../images/productItems/nha/livingroom4.jpg",
                size:[
                    {
                        key:"S",
                        stock: 10,
                    },
                    {
                        key:"M",
                        stock: 20,
                    },
                    {
                        key:"L",
                        stock: 30,
                    }
                ]
            }
        ]
    },
    {
        img:"../images/productItems/nha/bedroom1.jpg",
        img1:"../images/productItems/nha/bedroom1.1.jpg",
        img2:"../images/productItems/nha/bedroom1.2.jpg",
        img3:"../images/productItems/nha/bedroom1.3.jpg",
        name:"Sofa gray",
        price:200,
        star: "★★★★☆",
        quantity:1,
        type:"Bedroom",
        description: "Good product, high quality, reasonable price, worth buying, Brief introduction of wood products and export situation in Vietnam today: Wood and wood products are one of the key economic export products of the country and a bright spot in the export picture. As a result, wood products also gradually become diversified, many designs are abundant" ,
        options:[
            {
                src:"../images/productItems/nha/bedroom1.jpg",
                size:[
                    {
                        key:"S",
                        stock: 10,
                    },
                    {
                        key:"M",
                        stock: 20,
                    },
                    {
                        key:"L",
                        stock: 30,
                    }
                ]
            }
        ]
    },
    {
        img:"../images/productItems/nha/bedroom2.jpg",
        img1:"../images/productItems/nha/bedroom2.1.jpg",
        img2:"../images/productItems/nha/bedroom2.2.jpg",
        img3:"../images/productItems/nha/bedroom2.3.jpg",
        name:"Bed brow",
        price:500,
        quantity:1,
        star: "★★★★☆",
        type:"Bedroom",
        description: "Good product, high quality, reasonable price, worth buying, Brief introduction of wood products and export situation in Vietnam today: Wood and wood products are one of the key economic export products of the country and a bright spot in the export picture. As a result, wood products also gradually become diversified, many designs are abundant" ,
        options:[
            {
                src:"../images/productItems/nha/bedroom2.jpg",
                size:[
                    {
                        key:"S",
                        stock: 10,
                    },
                    {
                        key:"M",
                        stock: 20,
                    },
                    {
                        key:"L",
                        stock: 30,
                    }
                ]
            }
        ]
    },
    {
        img:"../images/productItems/nha/bedroom3.jpg",
        img1:"../images/productItems/nha/bedroom3.1.jpg",
        img2:"../images/productItems/nha/bedroom3.2.jpg",
        img3:"../images/productItems/nha/bedroom3.3.jpg",
        name:"Wardrobe",
        price:600,
        quantity:1,
        star: "★★★★☆",
        type:"Bedroom",
        description: "Good product, high quality, reasonable price, worth buying, Brief introduction of wood products and export situation in Vietnam today: Wood and wood products are one of the key economic export products of the country and a bright spot in the export picture. As a result, wood products also gradually become diversified, many designs are abundant" ,
        options:[
            {
                src:"../images/productItems/nha/bedroom3.jpg",
                size:[
                    {
                        key:"S",
                        stock: 10,
                    },
                    {
                        key:"M",
                        stock: 20,
                    },
                    {
                        key:"L",
                        stock: 30,
                    }
                ]
            }
        ]
    },
    {
        img:"../images/productItems/nha/bedroom4.jpg",
        img1:"../images/productItems/nha/bedroom4.1.jpg",
        img2:"../images/productItems/nha/bedroom4.2.jpg",
        img3:"../images/productItems/nha/bedroom4.3.jpg",
        name:"Bedside shelf",
        price:400,
        quantity:1,
        star: "★★★★☆",
        type:"Bedroom",
        description: "Good product, high quality, reasonable price, worth buying, Brief introduction of wood products and export situation in Vietnam today: Wood and wood products are one of the key economic export products of the country and a bright spot in the export picture. As a result, wood products also gradually become diversified, many designs are abundant" ,
        options:[
            {
                src:"../images/productItems/nha/bedroom4.jpg",
                size:[
                    {
                        key:"S",
                        stock: 10,
                    },
                    {
                        key:"M",
                        stock: 20,
                    },
                    {
                        key:"L",
                        stock: 30,
                    }
                ]
            }
        ]
    },
    {
        img:"../images/productItems/nha/kitchen1.jpg",
        img1:"../images/productItems/nha/kitchen1.1.jpg",
        img2:"../images/productItems/nha/kitchen1.2.jpg",
        img3:"../images/productItems/nha/kitchen1.3.jpg",
        name:"Kitchen Cabinets",
        price:300,
        quantity:1,
        star: "★★★☆☆",
        type:"Kitchen",
        description: "Good product, high quality, reasonable price, worth buying, Brief introduction of wood products and export situation in Vietnam today: Wood and wood products are one of the key economic export products of the country and a bright spot in the export picture. As a result, wood products also gradually become diversified, many designs are abundant" ,
        options:[
            {
                src:"../images/productItems/nha/kitchen1.jpg",
                size:[
                    {
                        key:"S",
                        stock: 10,
                    },
                    {
                        key:"M",
                        stock: 20,
                    },
                    {
                        key:"L",
                        stock: 30,
                    }
                ]
            }
        ]
    },
    {
        img:"../images/productItems/nha/kitchen2.jpg",
        img1:"../images/productItems/nha/kitchen2.1.jpg",
        img2:"../images/productItems/nha/kitchen2.2.jpg",
        img3:"../images/productItems/nha/kitchen2.3.jpg",
        name:"Diningroom chairs",
        price:200,
        quantity:1,
        star: "★★★☆☆",
        type:"Kitchen",
        description: "Good product, high quality, reasonable price, worth buying, Brief introduction of wood products and export situation in Vietnam today: Wood and wood products are one of the key economic export products of the country and a bright spot in the export picture. As a result, wood products also gradually become diversified, many designs are abundant" ,
        options:[
            {
                src:"../images/productItems/nha/kitchen2.jpg",
                size:[
                    {
                        key:"S",
                        stock: 10,
                    },
                    {
                        key:"M",
                        stock: 20,
                    },
                    {
                        key:"L",
                        stock: 30,
                    }
                ]
            }
        ]
    },
    {
        img:"../images/productItems/nha/kitchen3.jpg",
        img1:"../images/productItems/nha/kitchen2.1.jpg",
        img2:"../images/productItems/nha/kitchen2.2.jpg",
        img3:"../images/productItems/nha/kitchen2.3.jpg",
        name:"Diningroom chairs 2",
        price:500,
        quantity:1,
        star: "★★★☆☆",
        type:"Kitchen",
        description: "Good product, high quality, reasonable price, worth buying, Brief introduction of wood products and export situation in Vietnam today: Wood and wood products are one of the key economic export products of the country and a bright spot in the export picture. As a result, wood products also gradually become diversified, many designs are abundant" ,
        options:[
            {
                src:"../images/productItems/nha/kitchen3.jpg",
                size:[
                    {
                        key:"S",
                        stock: 10,
                    },
                    {
                        key:"M",
                        stock: 20,
                    },
                    {
                        key:"L",
                        stock: 30,
                    }
                ]
            }
        ]
    },
    {
        img:"../images/productItems/nha/kitchen4.jpg",
        img1:"../images/productItems/nha/kitchen1.1.jpg",
        img2:"../images/productItems/nha/kitchen1.2.jpg",
        img3:"../images/productItems/nha/kitchen1.3.jpg",
        name:"Kitchen Cabinets 2",
        price:600,
        quantity:1,
        star: "★★★☆☆",
        type:"Kitchen",
        description: "Good product, high quality, reasonable price, worth buying, Brief introduction of wood products and export situation in Vietnam today: Wood and wood products are one of the key economic export products of the country and a bright spot in the export picture. As a result, wood products also gradually become diversified, many designs are abundant" ,
        options:[
            {
                src:"../images/productItems/nha/kitchen4.jpg",
                size:[
                    {
                        key:"S",
                        stock: 10,
                    },
                    {
                        key:"M",
                        stock: 20,
                    },
                    {
                        key:"L",
                        stock: 30,
                    }
                ]
            }
        ]
    },





]

function uuid() {
    return new Date().getMilliseconds() + Math.floor(Math.random() * 999999999)
}

// Duyệt mảng listProductsStock để thêm id cho từng product (uuid()) và thêm quantity
for (let i = 0; i < listProductsStock.length; i++) {
    listProductsStock[i].id = uuid();
// Duyệt mảng listProductsStock và duyệt tiếp mảng options để thêm idOption (uuid)
    for (let j = 0; j < listProductsStock[i].options.length; j++) {
        listProductsStock[i].options[j].id = uuid();  }
}
//setItem =>key là "listProducts" đưa listProductsStock vào localstorega
let checkListProducts = JSON.parse(localStorage.getItem("listProducts"))
if (!checkListProducts) {
    localStorage.setItem("listProducts", JSON.stringify(listProductsStock));
}






//B1: Tạo hàm renderListProduct(param){}
//B2: tọa biến result = ""
//B3: loops mảng params và gán vào biến result nội dung sử dụng cú pháp template String
//B4: nôi dung template string như sau:

/*
* <div class="">
     <div class="">
     * <img/>
     * </div>
     *
     * <div>
            <div>
            * <span>param[i].type</span>
            * <span>S-M-L</span>
            </div>
            * <h4>param[i].name</h4>
            * <p>price</p>
*sử dụng querySelector gán innerHTML = result
* css cho thẻ content-container = flex, display: none
*
* */
const USDollar=new Intl.NumberFormat('en-US',{
    style:'currency',
    currency:'USD'
})
const VND=new Intl.NumberFormat('vi-VN',{
    style:'currency',
    currency:'VND'
})

function renderListProduct(params) {
    let result = "";
    for (let i = 0; i < params.length; i++) {
        result += `
        <div class="product-item" onclick="renderProductItem('${params[i].id}')">
        <div class="product-image">
        <img src="${params[i].img}" alt=""/>
        </div>
        <div class="product-description">
        <div class="product-type">
        <span>${params[i].type}</span>
        
</div>
        <h4 class="product-name">${params[i].name}</h4>
        <p>${USDollar.format(params[i].price)}</p>
        </div>
        </div>
        `
    }
document.querySelector(".content-container").innerHTML=result;
    document.querySelector(".content-container").style.display="flex";
        document.querySelector(".banner-container").style.display="none";
        document.querySelector("main").style.display="none";

        
}

function renderListAllProducts() {
    let listProducts=JSON.parse(localStorage.getItem("listProducts"))
    renderListProduct(listProducts)
    document.querySelector(".listPage").style.display="block"
    pagination()
}

function renderKitchenListProduct() {
    let listProducts=JSON.parse(localStorage.getItem("listProducts"))
    let listProductsKitchen=[]
    for (let i=0;i<listProducts.length;i++){
        if (listProducts[i].type=="Kitchen"){
            listProductsKitchen.push(listProducts[i])
        }
    }
    renderListProduct(listProductsKitchen)
    document.querySelector(".listPage").style.display="none";
    pagination()
}

function renderLivingroomListProduct() {
    let listProducts=JSON.parse(localStorage.getItem("listProducts"))
    let listProductsLivingroom=[]
    for (let i=0;i<listProducts.length;i++){
        if (listProducts[i].type=="Livingroom"){
            listProductsLivingroom.push(listProducts[i])
        }
    }
    renderListProduct(listProductsLivingroom)
    document.querySelector(".listPage").style.display="none";
    pagination()
}


function renderBedroomListProduct() {
    let listProducts=JSON.parse(localStorage.getItem("listProducts"))
    let listProductsBedroom=[]
    for (let i=0;i<listProducts.length;i++){
        if (listProducts[i].type=="Bedroom"){
            listProductsBedroom.push(listProducts[i])
        }
    }
    renderListProduct(listProductsBedroom)
    document.querySelector(".listPage").style.display="none";
    pagination()
}


//B1 Tạo hàm phân trang (pagination)
//B2 khởi tạo biến thisPage (trang hiện tại), biến limit (number),biến list(querySelectorAll(".product-item"))
//B3 tạo hàm loadItem(): chứa 2 biến beginGet(limit*(thisPage-1)),,endGet (limit * thisPage-1)
//B3.1 vòng lặp for mảng list (forEach nhận vào 2 tham số) bên trong if(key>= beginGet&& key<= endGet)
//=>item.style.display ="block" còn ko thì none và gọi hàm listPage()
//B3.2 tạo hàm listPage(), tạo biến count = độ dài của mảng list/ limit và được làm tròn lên
//B4.1 check nếu thisPage !=1
//B4.1.1 tạo biến prev = document.createElement('li')
//B4.1.2 tạo nội dung cho innerText cho biến prev gán ='PREV'
//B4.1.3 setAttribute cho prev sự kiện 'onclick', value là "changePage("+ (thisPage-1)+")"
//B4.1.4 appendChild(prev) cho class".listPage"
//B4.2 vòng lặp for mảng count
//B4.2.1 tạo biên newPage=createElement("li")
//B4.2.2 gán newPage.innerText=i
//B4.2.3 check nếu i== thisPage thì thêm classList('active')
//B4.2.4 setAttribute cho newPage sự kiện onclick, gtri là hàm "changePage("+ (thisPage+1)+")"
//B4.2.5 querySelector class.listPage để appendChild(newPage)
//B4.3 check nếu thisPage khác count thì
//B4.3.1 tạo biến next, gán thêm phần tử "li"
//B4.3.2 next.innetText='NEXT'
//B4.3.3 setAttribute cho next sự kiện onclick hàm "changePage("+ (thisPage-1)+")"
//B4.3.4 querySelector listPage để appenChild(next)

// B5 tạo hàm changePage(i) xử lý gán thisPage = i
// B5.1 gọi hàm loadItem()
// B6 đính kèm hàm changePage vào global object -> window.changePage= changePage

// B1: Tạo hàm phân trang (pagination)
function pagination() {
    let thisPage = 1;
    let limit = 8;
    let list = document.querySelectorAll(".product-item")

    function loadItem() {
        let beginGet = limit * (thisPage - 1 )
        let endGet = limit * thisPage - 1
        list.forEach((item, key) => {
            if(key >= beginGet && key <= endGet) {
                item.style.display = "block"
            } else {
                item.style.display = "none"
            }
        })
        listPage()
    }
    loadItem()

    function listPage() {
        let count = Math.ceil(list.length / limit)
        document.querySelector('.listPage').innerHTML = ''

        if(thisPage != 1) {
            let prev = document.createElement("li")
            prev.innerText = 'PREV'
            prev.setAttribute('onclick', "changePage(" + (thisPage - 1) + ")")
            document.querySelector('.listPage').appendChild(prev)
        }
        for(let i = 1; i <= count; i++) {
            let newPage = document.createElement("li")
            newPage.innerText = i;
            if(i == thisPage) {
                newPage.classList.add('active')
            }
            newPage.setAttribute('onclick', "changePage(" + i + ")")
            document.querySelector(".listPage").appendChild(newPage)
        }
        if(thisPage != count) {
            let next = document.createElement("li")
            next.innerText = 'NEXT'
            next.setAttribute("onclick", "changePage(" + (thisPage + 1 ) + ")")
            document.querySelector('.listPage').appendChild(next)
        }
    }
    function changePage(i) {
        thisPage = i
        loadItem()
    }
    window.changePage = changePage

}


// log in && log out
let checkLogin= localStorage.getItem("checkLogin")
if (checkLogin){
    document.getElementsByClassName("login__button")[0].style.display="none";
    document.getElementsByClassName("logout__button")[0].style.display="block";

}
if (!checkLogin){
    document.getElementsByClassName("login__button")[0].style.display="block";
    document.getElementsByClassName("logout__button")[0].style.display="none";

}
function logOut() {
    let confirm1 = confirm("bạn có muốn thoát hay ko?");
    if (confirm1) {
        localStorage.removeItem("checkLogin");
        window.location.reload();
    }
}

// B1 tạo hàm renderProductItem(idProduct)
// B2. getItem để lấy dc danh sách "listProducts" trong localstorage
// B3. lắp mảng listProducts để lấy sản phẩm chi tiết thông qua id
// B4. render ra sp chi tiết, bao gồm image, color, name, price, description

function renderProductItem(idProduct) {
    let listProducts = JSON.parse(localStorage.getItem("listProducts"));

    let productItem = listProducts.find(item => {
        return item.id == idProduct;
    });
    console.log("productItem", productItem)

    let result = `
        <div class="product">
            <div class="productItem-image">
                <div class="productItem-main-image">
                    <img src="${productItem.img}" alt="" class="main-image"/>
                    <div class="productItem-main-image2">
                        <img src="${productItem.img1}" alt="" class="main-image"/>
                        <img src="${productItem.img2}" alt="" class="main-image"/>
                        <img src="${productItem.img3}" alt="" class="main-image"/>
                        <img src="${productItem.img}" alt="" class="main-image"/>
                    </div>
                </div>
             
                <form class="productItem-description" method="POST">
                    <h2>${productItem.name}</h2>
                    <h3 class="star">★★★★★</h3>
                    <h3>${USDollar.format(productItem.price)}</h3>
                    <p class="des">Good product, high quality, reasonable price, worth buying, Brief introduction of wood products and export situation in Vietnam today: Wood and wood products are one of the key economic export products of the country and a bright spot in the export picture. As a result, wood products also gradually become diversified, many designs are abundant</p>
                    <h4>FREE SHIP</h4>
                    <button class="cart-button" type="submit">
                    <span class="add-to-cart">Add to cart</span>
                    <span class="added">Added</span>
                    <i class="fas fa-shopping-cart"></i>
                    <i class="fas fa-box"></i>
                </button>
                    
                  
                  
                </form>
            </div>
        </div>
    `;

    document.querySelector(".content-container").style.display = "flex";
    document.querySelector(".content-container").innerHTML = result;
    document.querySelector(".banner-container").style.display = "none";
    document.querySelector(".main1").style.display="none";
  document.querySelector(".main2").style.display="none";
    document.querySelector(".listPage").style.display = "none";
    document.getElementById("asd").style.display = "none";
    document.getElementById("search").value = "";

    const thumbnailImages = document.querySelectorAll(".productItem-main-image2 img");
    const mainImage = document.querySelector(".productItem-main-image img");

    thumbnailImages.forEach(thumbnail => {
        thumbnail.addEventListener("click", () => {
            mainImage.src = thumbnail.src;
        });
    });

    let form = document.querySelector("form");

    form.addEventListener("submit", function (e) {
        e.preventDefault();
        if (checkLogin == null) {
            document.querySelector(".cart-button").style.display="none";
            alert("Đăng nhập mới được mua");
            return;
        }
         addToCard(productItem);
        renderCartItems();
    });


    const cartButtons = document.querySelectorAll('.cart-button');

cartButtons.forEach(button => {
	button.addEventListener('click', cartClick);
});

function cartClick() {
	let button = this;
	button.classList.add('clicked');
}
    
}



function addToCard(productItem) {
    let listUsers = JSON.parse(localStorage.getItem("listUsers"));
    let checkLogin = localStorage.getItem("checkLogin");
    console.log("listUsers", listUsers);

    let user = listUsers.find((user) => {
        return user.idUser == checkLogin;
    });

    if (user) {
        let cartUser = user.cartUser;
        let giongnhau = cartUser.find((item) => item.id === productItem.id);
    if (giongnhau) {
         giongnhau.quantity += productItem.quantity;
        } else {
           cartUser.push(productItem);
        }
    
        localStorage.setItem("listUsers", JSON.stringify(listUsers));

        let result2 = "";

        for (let i = 0; i < cartUser.length; i++) {
            result2 += `
                <div class="cartProductItem">
                    <div class="cartItem">
                        <div class="cartProductItem-image">
                            <img src="${cartUser[i].img}" alt="" style="width: 150px;height: 150px;"/>
                        </div>
                        <div class="cartProductItem-info">
                            <h4>${cartUser[i].name}</h4>
                            <p>${USDollar.format(cartUser[i].price)}</p>
                            <div class="changeQuantity-button">
                                <button>
                                    <span class="material-symbols-outlined">remove</span>
                                </button>
                                <span class="productItem-quantity" id="quantity">0</span>
                                <button>
                                    <span class="material-symbols-outlined">add</span>
                                </button>
                            </div>
                        </div>  
                    </div>
                    <div class="cartItem-delete-button">
                        <span class="material-symbols-outlined">close</span>
                    </div>
                </div>   
            `;

            document.getElementById("cartProductItems").innerHTML = result2;
          
        }

    }
}


function renderCartItems() {
    let listUsers=JSON.parse(localStorage.getItem("listUsers"));
    let checkLogin= localStorage.getItem("checkLogin");
    let user = listUsers.find((user)=>{
        return user.idUser==checkLogin;
    });
    if (user){
        let cartUser=user.cartUser;
        let result2="";
        let total = 0;
let number=0;
        for (let i = 0; i < cartUser.length; i++) {
             number+=cartUser[i].quantity;
            total += cartUser[i].price * cartUser[i].quantity;
          
            result2 += `
                <div class="cartProductItem">
                    <div class="cartItem">
                        <div class="cartProductItem-image">
                            <img src="${cartUser[i].img}" alt="" style="width: 150px;height: 150px"/>
                        </div>
                        <div class="cartProductItem-info">
                            <h4>${cartUser[i].name}</h4>
                           
                            <p>${USDollar.format(cartUser[i].price)}</p>
                            
                            <div class="changeQuantity-button">
                                <button>
                                    <span class="material-symbols-outlined" onclick="decreaseQuatity(${cartUser[i].id})">remove</span>
                                </button>
                                <span class="productItem-quantity" id="quantity">${cartUser[i].quantity}</span>
                                <button>
                                    <span class="material-symbols-outlined"  onclick="increaseQuatity(${cartUser[i].id})">add</span>
                                
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="cartItem-delete-button">
                        
                        <button class="button" onclick="deleteUser(${cartUser[i].id})">
                        <i class="fa-solid fa-trash" style="color: #f5f5f5;"></i>
                      </button>
                        </div>
                </div>
            `;


        }
        document.getElementById("cartProductItems").innerHTML = result2;
       
        document.getElementById("total" ).innerHTML = `Total : ${USDollar.format(total)}`
        document.getElementById("number" ).innerHTML = number
       
    }
}

window.addEventListener("load", renderCartItems);






// function xoa
function deleteUser(idProduct) {
    let listUsers=JSON.parse(localStorage.getItem("listUsers"));
    let checkLogin= localStorage.getItem("checkLogin");
    for (let i = 0; i < listUsers.length; i++) {
        if (listUsers[i].idUser == checkLogin) {
            for (let j = 0; j < listUsers[i].cartUser.length; j++) {
                if (listUsers[i].cartUser[j].id == idProduct) {
                    listUsers[i].cartUser.splice(j, 1);
                    localStorage.setItem("listUsers", JSON.stringify(listUsers));
                    renderCartItems();
                }
            }
        }
    }
}

// function tăng sp
function increaseQuatity(idProduct) {
    let listUsers=JSON.parse(localStorage.getItem("listUsers"));
    let checkLogin= localStorage.getItem("checkLogin");
    // lấy giỏ hàng ra
    for (let i = 0; i < listUsers.length; i++) {
        if (listUsers[i].idUser == checkLogin) {
            // user[i].cart
            for (let j = 0; j < listUsers[i].cartUser.length; j++) {
                if (listUsers[i].cartUser[j].id == idProduct) {
                    listUsers[i].cartUser[j].quantity = ++listUsers[i].cartUser[j].quantity;
                    localStorage.setItem("listUsers", JSON.stringify(listUsers));
                    renderCartItems();
                    return;
                }
            }
        }
    }
}

// giảm sp
function decreaseQuatity(idProduct) {
    let listUsers=JSON.parse(localStorage.getItem("listUsers"));
    let checkLogin= localStorage.getItem("checkLogin");
    // lấy giỏ hàng ra
    for (let i = 0; i < listUsers.length; i++) {
        if (listUsers[i].idUser == checkLogin) {
            // user[i].cart
            for (let j = 0; j < listUsers[i].cartUser.length; j++) {
                if (listUsers[i].cartUser[j].id == idProduct) {
                    if (listUsers[i].cartUser[j].quantity == 1) {
                        return;
                    }
                    listUsers[i].cartUser[j].quantity = --listUsers[i].cartUser[j].quantity;

                    localStorage.setItem("listUsers", JSON.stringify(listUsers));
                    renderCartItems();
                    return;
                }
            }
        }
    }
}



// Bấm vào sổ ra card-container

function myButton() {
    document.getElementById("content").style.display = "block";
    document.getElementById("a").style.display = "block";
    document.getElementById("content").classList.toggle("show");
    document.getElementById("a").classList.toggle("show");
}
function closeContainer(){
    document.getElementById("content").style.display="none";
    document.getElementById("a").style.display="none";


}



// function search
document.querySelector(".search").addEventListener("input", searchResult);
let isSearchResultVisible = false;
function searchResult() {
  let listProducts = JSON.parse(localStorage.getItem("listProducts")) || [];
  let search = document.getElementById("search").value.toLowerCase();
  let result = listProducts.filter((want) =>
    want.name.toLowerCase().includes(search)
  );
  if (search !== "") {
    let element = result.map((product) => {
      return `
               
            
    <div class="seacrh-ProductItem card5" onclick="renderProductItem('${product.id}')">
    <div class="card5-content">
    <div class="seacrh-ProductItem-image">
               <img src="${product.img}" alt="" style="width: 180px;">
        </div>
         
           <div  class="seacrh-ProductItem-info">
               <h4 class="product__item--name">
                   ${product.name} 
                </h4>
                   <p class="product__item--price">
                   ${USDollar.format(product.price)}
                   </p>
            </div>
  </div>
       
                   
    </div>
            
            `;
    });
    document.getElementById("asd").innerHTML = element.join("");
    
    isSearchResultVisible = true;
    
  } else {
    document.getElementById("asd").innerHTML = "";
    
    isSearchResultVisible = false;
  }

  updateSearchResultVisibility();
  

}


function updateSearchResultVisibility() {
    const searchResultContainer = document.getElementById("asd");
    if (isSearchResultVisible) {
      searchResultContainer.style.display = "flex";
    } else {
      searchResultContainer.style.display = "none";
    }
  }
  updateSearchResultVisibility();

  
//  clear cart user
function buyProducts() {
    
    let users = JSON.parse(localStorage.getItem("listUsers")) || [];
   
    let checkLogin=JSON.parse(localStorage.getItem("checkLogin"))
    let userId = checkLogin; 
    
    let userIndex = users.findIndex(user => user.idUser == userId);
 
    if (userIndex >= 0) {
        let user = users[userIndex];
        if (user.cartUser=="") {
            showBillFail()
            return;
        }else if(user.card==""){
            
            window.location.href = "../pages/card.html";
            return;
        }else{
            
            let updatedCart =[]
            user.cartUser = updatedCart;
            localStorage.setItem("listUsers", JSON.stringify(users));
            showBill()
            renderCartItems()
            renderListProduct();
            return;
        }
     
      
       }
       showBillFail()
  }
